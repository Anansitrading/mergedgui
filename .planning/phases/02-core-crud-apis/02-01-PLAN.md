---
phase: 02-core-crud-apis
plan: 01
type: execute
wave: 1
wave_type: ASYNC
depends_on: []
files_modified:
  - server/app/routers/projects.py
  - server/app/services/projects.py
  - server/tests/test_projects.py
autonomous: true
difficulty: hard
---

<objective>
Implement all Project CRUD endpoints matching frontend TypeScript interfaces.

Purpose: Projects are the core entity — every other feature (skills, ingestion, members) revolves around them.
Output: 22 project-related endpoints with Supabase queries and RLS enforcement.
</objective>

<context>
@.planning/STATE.md
@server/app/models/project.py
@server/app/middleware/auth.py
@server/app/services/database.py
@database/001_project_creation_schema.sql
@src/services/projects.ts
</context>

<tasks>
<task type="auto">
  <name>Task 1: Create project service and router</name>
  <files>
    server/app/services/projects.py
    server/app/routers/projects.py
    server/app/main.py
  </files>
  <action>
    Create service layer with Supabase CRUD operations for projects:
    - list_projects(org_id, page, page_size, filters) → paginated
    - get_project(project_id) → single with relations
    - create_project(data, user_id, org_id) → new project
    - update_project(project_id, data) → updated project
    - delete_project(project_id)
    - validate_project_name(org_id, name) → unique check

    Create router with endpoints:
    - GET /projects → list (paginated, filterable by status/type)
    - POST /projects → create
    - GET /projects/{id} → get with repos, members, stats
    - PATCH /projects/{id} → update
    - DELETE /projects/{id}
    - POST /projects/{id}/repositories → add repository
    - GET /projects/{id}/repositories → list repositories
    - DELETE /projects/{id}/repositories/{repo_id}
    - GET /projects/{id}/members → list members
    - POST /projects/{id}/members → add member
    - PATCH /projects/{id}/members/{member_id} → update role
    - DELETE /projects/{id}/members/{member_id}
    - POST /projects/{id}/members/bulk-invite → bulk add
    - GET /projects/{id}/ingestion → get ingestion progress
    - GET /projects/{id}/files → list project files
    - POST /projects/validate-name → validate name uniqueness
    - POST /projects/validate-repository → validate repo URL

    Wire router into main.py with prefix.
    All data endpoints use require_auth dependency.
  </action>
  <verify>
    ```bash
    python3 -c "
    from server.app.routers.projects import router
    print(f'Routes: {len(router.routes)}')
    from server.app.main import app
    routes = [r.path for r in app.routes if 'project' in r.path]
    print(f'Project routes: {routes}')
    "
    ```
  </verify>
  <done>All project CRUD endpoints implemented with service layer and wired into main app</done>
</task>

<task type="auto">
  <name>Task 2: Create project endpoint tests</name>
  <files>
    server/tests/test_projects.py
  </files>
  <action>
    Create tests with mocked Supabase client:
    - Test CRUD lifecycle (create → get → update → delete)
    - Test pagination (page, page_size, total)
    - Test auth enforcement (401 without token)
    - Test validation (name length, duplicate name)
    - Test repository management
    - Test member management
  </action>
  <verify>
    ```bash
    python -m pytest server/tests/test_projects.py -v
    ```
  </verify>
  <done>Project endpoint tests pass with mocked Supabase responses</done>
</task>
</tasks>

<success_criteria>
- All project endpoints respond with correct status codes
- Pagination works (page, page_size, total count)
- Auth required on all data endpoints
- Name validation checks uniqueness within org
- Tests pass with mocked Supabase
</success_criteria>

<output>
After completion, create `.planning/phases/02-core-crud-apis/02-01-SUMMARY.md`
</output>
